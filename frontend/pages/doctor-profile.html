<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Doctor Profile</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles/doctor-profile.css') }}"
    />
  </head>
  <body>
    <!-- Navbar Section -->
    <div class="navbar">
      <div class="brand">CareConnect</div>
      <div class="nav-links">
        <a href="{{ url_for('index') }}">Home</a>
        <a href="{{ url_for('load_page', page_name='doctor-profile') }}"
          >Doctors</a
        >
        <a href="{{ url_for('load_page', page_name='booking-form') }}"
          >Appointment</a
        >
        <a href="{{ url_for('load_page', page_name='notifications') }}">
          <div class="notifications">
            <span class="icon">ðŸ””</span>
          </div>
        </a>
        <a href="{{ url_for('load_page', page_name='login') }}">Login</a>
      </div>
    </div>

    <!-- Search and Filter Section -->
    <div class="search-container">
      <div class="search-bar">
        <!-- Search by Name -->
        <input type="text" id="searchInput" placeholder="Search by name..." />

        <!-- Specialty Filter -->
        <select id="specialtyFilter" class="filter-dropdown">
          <option value="">All Specialties</option>
          <option value="Cardiologist">Cardiologist</option>
          <option value="Dermatologist">Dermatologist</option>
          <option value="Neurologist">Neurologist</option>
          <option value="Pediatrician">Pediatrician</option>
        </select>

        <!-- City Filter -->
        <select id="cityFilter" class="filter-dropdown">
          <option value="">All Cities</option>
          <option value="New York">New York</option>
          <option value="Los Angeles">Los Angeles</option>
          <option value="Chicago">Chicago</option>
        </select>

        <!-- Experience Filter -->
        <input
          type="number"
          id="experienceFilter"
          class="filter-dropdown"
          placeholder="Min Experience (years)"
          min="0"
        />

        <!-- Rating Filter -->
        <input
          type="number"
          id="ratingFilter"
          class="filter-dropdown"
          placeholder="Min Rating (1-5)"
          min="1"
          max="5"
          step="0.1"
        />

        <button id="searchButton">Search</button>
      </div>

      <div class="loading" id="loading" style="display: none">
        Loading results...
      </div>
      <div class="results" id="results"></div>
    </div>

    <!-- Doctor Profiles Section -->
    <div class="doctor-profiles-container" id="doctorProfiles"></div>

    <script>
      // Fetch doctors from API with filters
      async function fetchDoctors() {
        document.getElementById("loading").style.display = "block";

        // Get filter values
        const searchQuery = document
          .getElementById("searchInput")
          .value.toLowerCase();
        const specialty = document.getElementById("specialtyFilter").value;
        const city = document.getElementById("cityFilter").value;
        const minExperience = document.getElementById("experienceFilter").value;
        const minRating = document.getElementById("ratingFilter").value;

        // Construct API query parameters
        let queryParams = `?search=${searchQuery}`;
        if (specialty) queryParams += `&specialty=${specialty}`;
        if (city) queryParams += `&city=${city}`;
        if (minExperience) queryParams += `&min_experience=${minExperience}`;
        if (minRating) queryParams += `&min_rating=${minRating}`;

        // Fetch from API
        const response = await fetch(`/api/doctors${queryParams}`);
        const doctors = await response.json();

        // Hide loading indicator and render doctors
        document.getElementById("loading").style.display = "none";
        renderDoctors(doctors);
      }

      // Render doctor profiles dynamically
      function renderDoctors(doctors) {
        const profilesContainer = document.getElementById("doctorProfiles");
        profilesContainer.innerHTML = doctors.length
          ? ""
          : "<p>No doctors found.</p>";
        doctors.forEach((doctor) => {
          const doctorCard = document.createElement("div");
          doctorCard.className = "doctor-profile";
          doctorCard.innerHTML = `
                      <div class="doctor-photo">
                          <img src="${doctor.image}" alt="${doctor.name}">
                      </div>
                      <div class="doctor-details">
                          <h1>${doctor.name}</h1>
                          <p><strong>Specialty:</strong> ${doctor.specialty}</p>
                          <p><strong>Location:</strong> ${doctor.location}</p>
                          <p><strong>Experience:</strong> ${doctor.experience} years</p>
                          <div class="rating">â˜… ${doctor.rating}/5</div>
                          <a href="/booking-form?doctorId=${doctor.id}" class="book-appointment">Book Appointment</a>
                      </div>
                  `;
          profilesContainer.appendChild(doctorCard);
        });
      }

      // Search functionality on button click
      document
        .getElementById("searchButton")
        .addEventListener("click", fetchDoctors);

      // Initial load
      fetchDoctors();
    </script>
  </body>
</html>
